<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>userprofil</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  </head>
  <body>
    <style>


.card {
    position: relative;
    display: flex;
    flex-direction: column;
    min-width: 0;
    word-wrap: break-word;
    background-color: #fff;
    background-clip: border-box;
    border: 0 solid transparent;
    border-radius: .25rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 6px 0 rgb(218 218 253 / 65%), 0 2px 6px 0 rgb(206 206 238 / 54%);
}
.me-2 {
    margin-right: .5rem!important;
}
    </style>
    <%- include('../partials/user-header')%>
   

    <div class="container my-5">
		<div class="main-body">
			<div class="row">
				<div class="col-lg-4">




					<div class="card">
						<div class="card-body">
							<!-- <div class="d-flex flex-column align-items-center text-center">
								<img src="https://bootdey.com/img/Content/avatar/avatar6.png" alt="Admin" class="rounded-circle p-1 bg-primary" width="110">
								<div class="mt-3">
									<h4><%=userdatas.name%></h4>
									
								</div>
							</div> -->
<!-- <hr> -->
							
							<div class="card-body">
                <form action="/edituserdata" method="post">


                  <div class="row mb-3">
                    <div class="col-sm-3">
                        <h6 class="mb-0">Email</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                      <h6 class="mb-2 mx-2"><%=userdatas.email%></h6>
                    </div>
                </div>
              
                <div class="row mb-3">
                  <div class="col-sm-3">
                      <h6 class="mb-0">Name</h6>
                  </div>
                  <div class="col-sm-9 text-secondary">
                      <input type="text" class="form-control"  name="name" value="<%=userdatas.name%>">
                  </div>
              </div>
              <div class="row mb-3">
                <div class="col-sm-3">
                    <h6 class="mb-0">Phone</h6>
                </div>
                <div class="col-sm-9 text-secondary">
                    <input type="text" class="form-control"  name="phone" value="<%=userdatas.phone%>">
                </div>
            </div>
                              
                               
                               
                             

                                <div class="row">
                                    <div class="col-sm-3"></div>
                                    <div class="col-sm-9 text-secondary">
                                        <input type="submit" class="btn btn-dark px-4" value="Save Changes">
                                    </div>
                                </div>
                              </form>
                            </div>

<hr class="my-4">
<h6 class="text-center">Change password</h6>

                            <div class="card-body">
                              <form action="/edituserpass" method="post" >
                                <div class="row mb-3">
                                    <div class="col-sm-3">
                                        <h6 class="mb-0">Current password</h6>
                                    </div>
                                    <div class="col-sm-9 text-secondary">
                                        <input type="password" name="current" class="form-control" >
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-sm-3">
                                        <h6 class="mb-0">New password</h6>
                                    </div>
                                    <div class="col-sm-9 text-secondary">
                                        <input type="password" name="new" class="form-control" >
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-sm-3">
                                        <h6 class="mb-0">Confirm password</h6>
                                    </div>
                                    <div class="col-sm-9 text-secondary">
                                        <input type="password" name="confirm" class="form-control" >
                                    </div>
                                </div>
                             

                                <div class="row">
                                    <div class="col-sm-3"></div>
                                    <div class="col-sm-9 text-secondary">
                                        <input type="submit" class="btn btn-dark px-4" value="Save Changes">
                                    </div>
                                </div>
                              </form>
                            </div>






                            <div class="container text-secondary d-flex justify-content-end">
                              <div class="row  my-2 ">
                               
                               
                                  <div class="col-sm-3 ">
                                  <div class="col-sm-9 ">
                                
                                      <a href="/logout" class="btn btn-dark ">Logout</a>
                                  </div>
                              
                              </div>
                            </div>
                            </div>











						</div>
					</div>
				</div>
				<div class="col-lg-8">
					<div class="card px-2">
                        <div class="div d-flex justify-content-between">
                            <h5 class="d-flex align-items-center mt-3 mx-3">Address</h5>
                            <button type="button" class="btn btn-dark btn-sm mx-4 my-4" data-bs-toggle="modal" data-bs-target="#exampleModal">
                                Add Address
                              </button>
                        </div>



<!-- Button trigger modal -->

  
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action="/addadderss" method="post">
            <div class="mb-3">
              <label for="recipient-name" class="col-form-label">Enter Your Name</label>
              <input type="text" class="form-control" id="recipient-name" name="name" placeholder=" Name">
            </div> 
            <div class="mb-3">
                <label for="recipient-name" class="col-form-label">Enter Your Mobile Number</label>
                <input type="text" class="form-control" id="recipient-name" name="phone" placeholder=" Mobile Number">
              </div>
              <div class="mb-3">
                <label for="recipient-name" class="col-form-label">Enter Your pincode</label>
                <input type="text" class="form-control" id="recipient-name" name="pincode" placeholder=" Pincode">
              </div>
            <div class="mb-3">
              <label for="message-text" class="col-form-label">Enter Your Address:</label>
              <input  type="text" class="form-control" id="message-text" name="address" placeholder="Address">
            </div>
          
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      <button type="submit" class="btn btn-dark">Save changes</button>
    </div>
  </form>
        </div>
        
    </div>
  </div>

                       
  <table class="table table-bordered">
    <thead>
      <tr>
        
        <th scope="col">Name</th>
        <th scope="col">Phone no</th>
        <th scope="col">Address</th>
        <th scope="col">Pin code</th>

      </tr>
    </thead>
    <tbody>
      <% for (let i = 0; i < userdatas.addresses.length; i++) { %>
      <tr>
       
        <td><%=userdatas.addresses[i].name%></td>
        <td><%=userdatas.addresses[i].phone%></td>
        <td><%=userdatas.addresses[i].address%></td>
        <td><%=userdatas.addresses[i].pincode%></td>

      </tr>
      <% } %>
    
   
    </tbody>
  </table>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<div class="card px-2">
								
                                <h5 class="d-flex align-items-center mt-3 mx-3">Order</h5>
                                <table class="table table-bordered ">
                                    <thead>
                                      <tr>
                                        <th scope="col">Date</th>
                                        <th scope="col">User</th>
                                        <th scope="col">Payment</th>
                                        <th scope="col">Status</th>
                                        <th scope="col">Items</th>
                                        <th scope="col">Total</th>

                                      </tr>
                                    </thead>
   
                                   <tbody>

                                      
                                      <% order.forEach((orderData)=>{ %>
                                        <%let date =orderData.date %>
                                              <%let isoString = date.toISOString()%>
                                              <%let newDate = isoString.split('T')[0]%>




                                              <%const returnPeriod = 5%>
                                              <%const purchaseDate = new Date( newDate);%>
                                              <%const expirationDate = new Date(purchaseDate);%>
                                              <%expirationDate.setDate(expirationDate.getDate() + returnPeriod);%>
                                              <%=console.log(expirationDate)%>


                                             
                                        <tr>
                                          <td> <%=newDate%></td>
                                          <td><%=orderData.addresses[0].name%></td>
                                          <td><%=orderData. payment%></td>
                                          
                                          <td> 
                                            <form action="/userorderstatus" method="post" class="d-flex ">
                                            <select class="form-select form-select-lg mb-3 "  name="select" aria-label=".form-select-lg example" style="width: 200px; " >
                                            
                                              <option  selected><%=orderData. status%></option>
                                              
                                              <%if(orderData.status === 'delivered' && purchaseDate < expirationDate){%>
                                              <option   value="return" >Return</option>
                                              <%}else if(orderData.status === 'delivered'  && purchaseDate > expirationDate ){%>
                                                <option disabled   value="return" >Return</option>
                                           
                                            <%}else if(orderData.status === 'cancel'){%>
                                              <option disabled value="cancel">Cancel</option>
                                              <% } else  { %>
                                                <option   value="cancel" >Cancel</option>
                                              <%}%>
                                              
                                              <input type="text" name="proid" value="<%=orderData._id%>"  class="d-none">
                    
                                            </select>
                                            <%if(orderData.status === 'delivered' && purchaseDate < expirationDate){%>
                                              <button class=" btn btn-dark mx-2"  style="height: 50px; padding-top: 10px;" type="submit"  >Update</button>
                                              <%}else if(orderData.status === 'delivered'  && purchaseDate > expirationDate ){%>
                                                <input type="hidden" name="" id="">
                                            <%}else if(orderData.status === 'cancel'){%>
                                              <input type="hidden" name="" id="">
                                              <% } else { %>
                                                <button class=" btn btn-dark mx-2"  style="height: 50px; padding-top: 10px;" type="submit"  >Update</button>
                                              <%}%>
                                              <!-- <button class=" btn btn-dark mx-2"  style="height: 50px; padding-top: 10px;" type="submit"  >Update</button> -->
                                          </form>
                                        </td>
                                         
                                          <td><%=orderData.product.length%></td>
                                          <td ><%=orderData.total%> </td>
                                         
                    
                    
                                        </tr>
                                        <%})%>
                                      
                                    </tbody>
                                  </table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
  <%- include('../partials/user-footer')%>
 


    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
  </body>
</html>










